@{
    ViewData["Title"] = "Analyst Views";
    Layout = "~/Views/Shared/_Account.cshtml";
}

<section class="mx-auto w-full max-w-6xl">
    <!-- Top row: title + search -->
    <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
        <div>
            <h1 class="text-[44px] font-semibold leading-tight tracking-[-0.02em] text-slate-950 dark:text-white">
                Analyst Views
            </h1>
        </div>

        <div class="w-full sm:w-[320px]">
            <div class="relative">
                <span
                    class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 dark:text-slate-300">
                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="7"></circle>
                        <path d="M21 21l-4.3-4.3"></path>
                    </svg>
                </span>

                <input id="avSearch" type="text" placeholder="Enter Symbol or Name" class="h-10 w-full rounded-full border border-slate-900/15 bg-white pl-10 pr-4 text-sm text-slate-950 placeholder:text-slate-500
                              focus:outline-none focus:ring-4 focus:ring-slate-900/10 focus:border-slate-900/30
                              dark:border-white/15 dark:bg-black dark:text-white dark:placeholder:text-slate-400
                              dark:focus:ring-white/10 dark:focus:border-white/25" />
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="mt-6 border-b border-slate-900/10 dark:border-white/10">
        <div class="flex flex-wrap items-center gap-6">
            <button class="avTabBtn relative pb-3 text-sm font-semibold text-slate-950 dark:text-white" data-tab="forex"
                aria-current="true">
                Forex
                <span class="absolute -bottom-[1px] left-0 h-[2px] w-full bg-brandYellow"></span>
            </button>

            <button
                class="avTabBtn pb-3 text-sm font-semibold text-slate-600 hover:text-slate-950 dark:text-slate-300 dark:hover:text-white"
                data-tab="crypto">
                Crypto
            </button>

            <button
                class="avTabBtn pb-3 text-sm font-semibold text-slate-600 hover:text-slate-950 dark:text-slate-300 dark:hover:text-white"
                data-tab="stocks">
                Stocks
            </button>

            <button
                class="avTabBtn pb-3 text-sm font-semibold text-slate-600 hover:text-slate-950 dark:text-slate-300 dark:hover:text-white"
                data-tab="indices">
                Indices
            </button>

            <button
                class="avTabBtn pb-3 text-sm font-semibold text-slate-600 hover:text-slate-950 dark:text-slate-300 dark:hover:text-white"
                data-tab="commodities">
                Commodities
            </button>
        </div>
    </div>

    <!-- Cards grid -->
    <div class="mt-6 grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3" id="avGrid">

        <!-- ====== CARD (template style) ====== -->
        <article class="avCard rounded-xl border border-slate-900/15 bg-white p-4 dark:border-white/15 dark:bg-black"
            data-tab="forex" data-symbol="USD/CAD" data-name="US Dollar / Canadian Dollar">
            <div class="flex items-start justify-between gap-3">
                <div class="min-w-0">
                    <div class="flex items-center gap-2">
                        <p class="truncate text-sm font-semibold text-slate-950 dark:text-white">USD/CAD</p>
                        <span class="rounded-md border border-slate-900/10 bg-slate-100 px-2 py-0.5 text-[11px] font-semibold text-slate-700
                                     dark:border-white/10 dark:bg-white/10 dark:text-slate-200">
                            30 MIN
                        </span>
                    </div>
                    <p class="mt-1 text-xs text-slate-600 dark:text-slate-300">Saturday, Dec 27, 2025 • 4:03 AM (UTC+1)
                    </p>
                </div>
                <p class="text-xs font-semibold text-slate-600 dark:text-slate-300">4:03 AM (UTC+1)</p>
            </div>

            <!-- Flat chart placeholder -->
            <div class="mt-3 rounded-lg border border-slate-900/10 bg-white p-3 dark:border-white/10 dark:bg-black">
                <div class="flex items-center gap-3 text-[11px] text-slate-600 dark:text-slate-300">
                    <span class="inline-flex items-center gap-1">
                        <span class="h-2 w-2 rounded-full bg-red-500"></span> MA 20 + BB
                    </span>
                    <span class="inline-flex items-center gap-1">
                        <span class="h-2 w-2 rounded-full bg-blue-500"></span> MA 50
                    </span>
                    <span class="ml-auto text-slate-400 dark:text-slate-500">Research © 2025</span>
                </div>

                <div
                    class="mt-2 h-[110px] w-full rounded-md border border-slate-900/10 bg-slate-50 dark:border-white/10 dark:bg-white/5">
                    <!-- You can replace this with a real chart later -->
                    <div class="relative h-full w-full overflow-hidden rounded-md">
                        <div class="absolute inset-0 opacity-60" style="background-image: linear-gradient(to right, transparent 0, transparent 24px, rgba(0,0,0,.06) 24px, rgba(0,0,0,.06) 25px);
                                    background-size: 25px 100%;">
                        </div>
                        <svg class="absolute inset-0 h-full w-full" viewBox="0 0 300 120" preserveAspectRatio="none">
                            <path
                                d="M0,85 C35,70 55,95 85,80 C110,68 130,92 160,78 C190,62 210,88 240,60 C265,45 280,55 300,35"
                                fill="none" stroke="currentColor" stroke-width="2"
                                class="text-slate-900 dark:text-white" opacity="0.9"></path>
                            <path
                                d="M0,95 C35,80 55,105 85,90 C110,78 130,102 160,88 C190,72 210,98 240,70 C265,55 280,65 300,45"
                                fill="none" stroke="currentColor" stroke-width="2" class="text-blue-600" opacity="0.9">
                            </path>
                            <path
                                d="M0,105 C35,95 55,115 85,102 C110,92 130,112 160,100 C190,88 210,110 240,85 C265,72 280,78 300,60"
                                fill="none" stroke="currentColor" stroke-width="2" class="text-red-500" opacity="0.75">
                            </path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="mt-4 grid grid-cols-2 gap-2 text-sm">
                <div>
                    <p class="text-xs text-slate-600 dark:text-slate-300">Expected Move</p>
                    <p class="mt-1 text-sm font-semibold text-emerald-600">↑ 26 – 38 PIPS</p>
                </div>
                <div class="text-right">
                    <p class="text-xs text-slate-600 dark:text-slate-300">Target</p>
                    <p class="mt-1 text-sm font-semibold text-emerald-600">1.3709</p>
                </div>
                <div>
                    <p class="text-xs text-slate-600 dark:text-slate-300">Pivot</p>
                    <p class="mt-1 text-sm font-semibold text-blue-600">1.3652</p>
                </div>
                <div class="text-right">
                    <p class="text-xs text-slate-600 dark:text-slate-300">Bias</p>
                    <p class="mt-1 text-sm font-semibold text-slate-950 dark:text-white">Bullish</p>
                </div>
            </div>

            <button type="button"
                class="mt-4 inline-flex h-10 w-full items-center justify-center rounded-lg bg-brandYellow text-sm font-semibold text-black
                           hover:brightness-95 active:brightness-90 focus:outline-none focus:ring-4 focus:ring-yellow-400/30">
                Trade
            </button>
        </article>

        <!-- More cards (same structure) -->
        <article class="avCard rounded-xl border border-slate-900/15 bg-white p-4 dark:border-white/15 dark:bg-black"
            data-tab="forex" data-symbol="GBP/USD" data-name="British Pound / US Dollar">
            <div class="flex items-start justify-between gap-3">
                <div class="min-w-0">
                    <div class="flex items-center gap-2">
                        <p class="truncate text-sm font-semibold text-slate-950 dark:text-white">GBP/USD</p>
                        <span class="rounded-md border border-slate-900/10 bg-slate-100 px-2 py-0.5 text-[11px] font-semibold text-slate-700
                                     dark:border-white/10 dark:bg-white/10 dark:text-slate-200">
                            30 MIN
                        </span>
                    </div>
                    <p class="mt-1 text-xs text-slate-600 dark:text-slate-300">Saturday, Dec 27, 2025 • 4:03 AM (UTC+1)
                    </p>
                </div>
                <p class="text-xs font-semibold text-slate-600 dark:text-slate-300">4:03 AM (UTC+1)</p>
            </div>

            <div class="mt-3 rounded-lg border border-slate-900/10 bg-white p-3 dark:border-white/10 dark:bg-black">
                <div class="flex items-center gap-3 text-[11px] text-slate-600 dark:text-slate-300">
                    <span class="inline-flex items-center gap-1"><span class="h-2 w-2 rounded-full bg-red-500"></span>
                        MA 20 + BB</span>
                    <span class="inline-flex items-center gap-1"><span class="h-2 w-2 rounded-full bg-blue-500"></span>
                        MA 50</span>
                    <span class="ml-auto text-slate-400 dark:text-slate-500">Research © 2025</span>
                </div>
                <div
                    class="mt-2 h-[110px] w-full rounded-md border border-slate-900/10 bg-slate-50 dark:border-white/10 dark:bg-white/5">
                </div>
            </div>

            <div class="mt-4 grid grid-cols-2 gap-2 text-sm">
                <div>
                    <p class="text-xs text-slate-600 dark:text-slate-300">Expected Move</p>
                    <p class="mt-1 text-sm font-semibold text-emerald-600">↑ 38 – 55 PIPS</p>
                </div>
                <div class="text-right">
                    <p class="text-xs text-slate-600 dark:text-slate-300">Target</p>
                    <p class="mt-1 text-sm font-semibold text-emerald-600">1.3557</p>
                </div>
                <div>
                    <p class="text-xs text-slate-600 dark:text-slate-300">Pivot</p>
                    <p class="mt-1 text-sm font-semibold text-blue-600">1.3477</p>
                </div>
                <div class="text-right">
                    <p class="text-xs text-slate-600 dark:text-slate-300">Bias</p>
                    <p class="mt-1 text-sm font-semibold text-slate-950 dark:text-white">Bullish</p>
                </div>
            </div>

            <button type="button"
                class="mt-4 inline-flex h-10 w-full items-center justify-center rounded-lg bg-brandYellow text-sm font-semibold text-black
                           hover:brightness-95 active:brightness-90 focus:outline-none focus:ring-4 focus:ring-yellow-400/30">
                Trade
            </button>
        </article>

        <article class="avCard rounded-xl border border-slate-900/15 bg-white p-4 dark:border-white/15 dark:bg-black"
            data-tab="forex" data-symbol="AUD/USD" data-name="Australian Dollar / US Dollar">
            <div class="flex items-start justify-between gap-3">
                <div class="min-w-0">
                    <div class="flex items-center gap-2">
                        <p class="truncate text-sm font-semibold text-slate-950 dark:text-white">AUD/USD</p>
                        <span class="rounded-md border border-slate-900/10 bg-slate-100 px-2 py-0.5 text-[11px] font-semibold text-slate-700
                                     dark:border-white/10 dark:bg-white/10 dark:text-slate-200">
                            30 MIN
                        </span>
                    </div>
                    <p class="mt-1 text-xs text-slate-600 dark:text-slate-300">Saturday, Dec 27, 2025 • 4:03 AM (UTC+1)
                    </p>
                </div>
                <p class="text-xs font-semibold text-slate-600 dark:text-slate-300">4:03 AM (UTC+1)</p>
            </div>

            <div class="mt-3 rounded-lg border border-slate-900/10 bg-white p-3 dark:border-white/10 dark:bg-black">
                <div class="flex items-center gap-3 text-[11px] text-slate-600 dark:text-slate-300">
                    <span class="inline-flex items-center gap-1"><span class="h-2 w-2 rounded-full bg-red-500"></span>
                        MA 20 + BB</span>
                    <span class="inline-flex items-center gap-1"><span class="h-2 w-2 rounded-full bg-blue-500"></span>
                        MA 50</span>
                    <span class="ml-auto text-slate-400 dark:text-slate-500">Research © 2025</span>
                </div>
                <div
                    class="mt-2 h-[110px] w-full rounded-md border border-slate-900/10 bg-slate-50 dark:border-white/10 dark:bg-white/5">
                </div>
            </div>

            <div class="mt-4 grid grid-cols-2 gap-2 text-sm">
                <div>
                    <p class="text-xs text-slate-600 dark:text-slate-300">Expected Move</p>
                    <p class="mt-1 text-sm font-semibold text-emerald-600">↑ 27 – 40 PIPS</p>
                </div>
                <div class="text-right">
                    <p class="text-xs text-slate-600 dark:text-slate-300">Target</p>
                    <p class="mt-1 text-sm font-semibold text-emerald-600">0.6754</p>
                </div>
                <div>
                    <p class="text-xs text-slate-600 dark:text-slate-300">Pivot</p>
                    <p class="mt-1 text-sm font-semibold text-blue-600">0.6694</p>
                </div>
                <div class="text-right">
                    <p class="text-xs text-slate-600 dark:text-slate-300">Bias</p>
                    <p class="mt-1 text-sm font-semibold text-slate-950 dark:text-white">Bullish</p>
                </div>
            </div>

            <button type="button"
                class="mt-4 inline-flex h-10 w-full items-center justify-center rounded-lg bg-brandYellow text-sm font-semibold text-black
                           hover:brightness-95 active:brightness-90 focus:outline-none focus:ring-4 focus:ring-yellow-400/30">
                Trade
            </button>
        </article>

        <!-- Crypto examples -->
        <article
            class="avCard rounded-xl border border-slate-900/15 bg-white p-4 dark:border-white/15 dark:bg-black hidden"
            data-tab="crypto" data-symbol="BTC/USD" data-name="Bitcoin">
            <div class="flex items-start justify-between gap-3">
                <div class="min-w-0">
                    <div class="flex items-center gap-2">
                        <p class="truncate text-sm font-semibold text-slate-950 dark:text-white">BTC/USD</p>
                        <span class="rounded-md border border-slate-900/10 bg-slate-100 px-2 py-0.5 text-[11px] font-semibold text-slate-700
                                     dark:border-white/10 dark:bg-white/10 dark:text-slate-200">1 H</span>
                    </div>
                    <p class="mt-1 text-xs text-slate-600 dark:text-slate-300">Today • 4:03 AM (UTC+1)</p>
                </div>
                <p class="text-xs font-semibold text-slate-600 dark:text-slate-300">4:03 AM</p>
            </div>
            <div
                class="mt-3 h-[150px] rounded-lg border border-slate-900/10 bg-slate-50 dark:border-white/10 dark:bg-white/5">
            </div>
            <div class="mt-4 grid grid-cols-2 gap-2 text-sm">
                <div>
                    <p class="text-xs text-slate-600 dark:text-slate-300">Expected Move</p>
                    <p class="mt-1 text-sm font-semibold text-emerald-600">↑ 1.2% – 2.4%</p>
                </div>
                <div class="text-right">
                    <p class="text-xs text-slate-600 dark:text-slate-300">Target</p>
                    <p class="mt-1 text-sm font-semibold text-emerald-600">—</p>
                </div>
                <div>
                    <p class="text-xs text-slate-600 dark:text-slate-300">Pivot</p>
                    <p class="mt-1 text-sm font-semibold text-blue-600">—</p>
                </div>
                <div class="text-right">
                    <p class="text-xs text-slate-600 dark:text-slate-300">Bias</p>
                    <p class="mt-1 text-sm font-semibold text-slate-950 dark:text-white">Mixed</p>
                </div>
            </div>
            <button type="button"
                class="mt-4 inline-flex h-10 w-full items-center justify-center rounded-lg bg-brandYellow text-sm font-semibold text-black
                           hover:brightness-95 active:brightness-90 focus:outline-none focus:ring-4 focus:ring-yellow-400/30">
                Trade
            </button>
        </article>

    </div>

    <!-- Empty state -->
    <div id="avEmpty"
        class="hidden mt-10 rounded-xl border border-slate-900/15 bg-white p-10 text-center dark:border-white/15 dark:bg-black">
        <p class="text-sm font-semibold text-slate-950 dark:text-white">No results</p>
        <p class="mt-1 text-sm text-slate-700 dark:text-slate-200">Try another symbol or switch tabs.</p>
    </div>
</section>

@section Scripts {
    <script>
        // ===== Analyst Views: tabs + search filter (flat/high-contrast) =====
        const tabButtons = Array.from(document.querySelectorAll(".avTabBtn"));
        const cards = Array.from(document.querySelectorAll(".avCard"));
        const search = document.getElementById("avSearch");
        const empty = document.getElementById("avEmpty");

        let activeTab = "forex";

        function setTabsUI() {
            tabButtons.forEach(btn => {
                const key = btn.getAttribute("data-tab");
                const isActive = key === activeTab;

                // reset classes
                btn.classList.remove("text-slate-950", "dark:text-white");
                btn.classList.add("text-slate-600", "dark:text-slate-300");

                // underline span
                const underline = btn.querySelector("span");
                if (underline) underline.remove();

                if (isActive) {
                    btn.classList.remove("text-slate-600", "dark:text-slate-300");
                    btn.classList.add("text-slate-950", "dark:text-white");
                    btn.setAttribute("aria-current", "true");

                    const u = document.createElement("span");
                    u.className = "absolute -bottom-[1px] left-0 h-[2px] w-full bg-brandYellow";
                    btn.classList.add("relative");
                    btn.appendChild(u);
                } else {
                    btn.removeAttribute("aria-current");
                }
            });
        }

        function applyFilter() {
            const term = (search?.value || "").trim().toLowerCase();
            let shown = 0;

            cards.forEach(card => {
                const tab = card.getAttribute("data-tab");
                const sym = (card.getAttribute("data-symbol") || "").toLowerCase();
                const name = (card.getAttribute("data-name") || "").toLowerCase();

                const tabOk = tab === activeTab;
                const termOk = !term || sym.includes(term) || name.includes(term);

                const show = tabOk && termOk;

                card.classList.toggle("hidden", !show);
                if (show) shown++;
            });

            empty.classList.toggle("hidden", shown !== 0);
        }

        tabButtons.forEach(btn => {
            btn.addEventListener("click", () => {
                activeTab = btn.getAttribute("data-tab") || "forex";
                setTabsUI();
                applyFilter();
            });
        });

        search?.addEventListener("input", applyFilter);

        // init
        setTabsUI();
        applyFilter();
    </script>
}