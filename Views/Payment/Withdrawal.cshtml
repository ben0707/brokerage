@{
    Layout = "~/Views/Shared/_Account.cshtml";
    ViewData["Title"] = "Withdrawal";
}

@* ===================== WITHDRAWAL PAGE (fits _Account.cshtml) ===================== *@

<div class="mx-auto w-full max-w-6xl px-2 sm:px-4 md:px-0">
    <!-- Page header -->
    <div class="mb-6">
        <h1 class="text-4xl font-semibold tracking-tight text-slate-900 dark:text-white">Withdrawal</h1>
        <a href="#"
            class="mt-2 inline-flex items-center gap-2 text-sm font-medium text-blue-600 hover:underline dark:text-blue-400">
            See all payment methods
        </a>
    </div>

    <!-- Layout: form + right panel -->
    <div class="grid grid-cols-1 gap-8 lg:grid-cols-12">
        <!-- LEFT: form -->
        <div class="lg:col-span-8">
            <div class="grid grid-cols-1 gap-4 md:grid-cols-12">
                <!-- Payment method dropdown -->
                <div class="md:col-span-8">
                    <label class="mb-2 block text-sm font-medium text-slate-700 dark:text-slate-200">
                        Payment method
                    </label>

                    <div class="relative" id="pmRoot">
                        <button id="pmBtn" type="button" class="flex h-12 w-full items-center justify-between rounded-md border border-slate-300 bg-white px-3
                                       hover:border-slate-400 focus:border-slate-500 dark:border-slate-700 dark:bg-black
                                       dark:hover:border-slate-600 dark:focus:border-slate-500 transition-colors"
                            aria-expanded="false">
                            <span class="flex items-center gap-3">
                                <span
                                    class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-black ring-1 ring-slate-200 dark:ring-slate-800">
                                    <img id="pmLogo" src="/assets/payments/online-bank.png" alt="Online Bank"
                                        class="h-4 w-4 object-contain" />
                                </span>
                                <span class="text-sm font-medium text-slate-900 dark:text-slate-50" id="pmLabel">
                                    Online Bank
                                </span>
                            </span>

                            <span class="text-slate-400 dark:text-slate-500">
                                <svg id="pmCaret" viewBox="0 0 20 20" class="h-5 w-5 transition-transform" fill="none"
                                    stroke="currentColor" stroke-width="1.8" stroke-linecap="round">
                                    <path d="M6 8l4 4 4-4" />
                                </svg>
                            </span>
                        </button>

                        <!-- Dropdown panel -->
                        <div id="pmPanel"
                            class="absolute left-0 top-[calc(100%+8px)] z-40 hidden w-full overflow-hidden rounded-xl
                                    border border-slate-200 bg-white shadow-xl dark:border-slate-800 dark:bg-slate-950">
                            <div class="px-3 py-2 text-xs font-semibold text-slate-500 dark:text-slate-400">
                                My saved methods
                            </div>

                            <button type="button" class="pm-item flex w-full items-center justify-between gap-3 px-3 py-3 text-left hover:bg-slate-50
                                           dark:hover:bg-slate-900/60" data-label="Online Bank"
                                data-sub="024••••218, GTBank" data-currency="NGN"
                                data-logo="/assets/payments/gtbank.png" data-terms-time="1 hour" data-fee="0%">
                                <span class="flex items-center gap-3">
                                    <span
                                        class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-black ring-1 ring-slate-200 dark:ring-slate-800">
                                        <img src="/assets/payments/online-bank.png" alt=""
                                            class="h-4 w-4 object-contain" />
                                    </span>
                                    <span>
                                        <span class="block text-sm font-medium text-slate-900 dark:text-slate-50">Online
                                            Bank</span>
                                        <span class="block text-xs text-slate-500 dark:text-slate-400">024••••218,
                                            GTBank</span>
                                    </span>
                                </span>
                                <span class="text-xs font-semibold text-slate-600 dark:text-slate-300">NGN</span>
                            </button>

                            <button type="button" class="pm-item flex w-full items-center justify-between gap-3 px-3 py-3 text-left hover:bg-slate-50
                                           dark:hover:bg-slate-900/60" data-label="Online Bank"
                                data-sub="151••••369, Access Bank" data-currency="NGN"
                                data-logo="/assets/payments/access.png" data-terms-time="1 hour" data-fee="0%">
                                <span class="flex items-center gap-3">
                                    <span
                                        class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-black ring-1 ring-slate-200 dark:ring-slate-800">
                                        <img src="/assets/payments/online-bank.png" alt=""
                                            class="h-4 w-4 object-contain" />
                                    </span>
                                    <span>
                                        <span class="block text-sm font-medium text-slate-900 dark:text-slate-50">Online
                                            Bank</span>
                                        <span class="block text-xs text-slate-500 dark:text-slate-400">151••••369,
                                            Access Bank</span>
                                    </span>
                                </span>
                                <span class="text-xs font-semibold text-slate-600 dark:text-slate-300">NGN</span>
                            </button>

                            <button type="button" class="pm-item flex w-full items-center justify-between gap-3 px-3 py-3 text-left hover:bg-slate-50
                                           dark:hover:bg-slate-900/60" data-label="Online Bank"
                                data-sub="901••••878, PALMPAY" data-currency="NGN"
                                data-logo="/assets/payments/palmpay.png" data-terms-time="Instant" data-fee="0%">
                                <span class="flex items-center gap-3">
                                    <span
                                        class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-black ring-1 ring-slate-200 dark:ring-slate-800">
                                        <img src="/assets/payments/online-bank.png" alt=""
                                            class="h-4 w-4 object-contain" />
                                    </span>
                                    <span>
                                        <span class="block text-sm font-medium text-slate-900 dark:text-slate-50">Online
                                            Bank</span>
                                        <span class="block text-xs text-slate-500 dark:text-slate-400">901••••878,
                                            PALMPAY</span>
                                    </span>
                                </span>
                                <span class="text-xs font-semibold text-slate-600 dark:text-slate-300">NGN</span>
                            </button>

                            <div class="px-3 py-2 text-xs font-semibold text-slate-500 dark:text-slate-400">
                                All payment methods
                            </div>

                            <button type="button" class="pm-item flex w-full items-center justify-between gap-3 px-3 py-3 text-left hover:bg-slate-50
                                           dark:hover:bg-slate-900/60" data-label="Online Bank" data-sub=""
                                data-currency="NGN" data-logo="/assets/payments/online-bank.png"
                                data-terms-time="1 hour" data-fee="0%">
                                <span class="flex items-center gap-3">
                                    <span
                                        class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-black ring-1 ring-slate-200 dark:ring-slate-800">
                                        <img src="/assets/payments/online-bank.png" alt=""
                                            class="h-4 w-4 object-contain" />
                                    </span>
                                    <span class="text-sm font-medium text-slate-900 dark:text-slate-50">Online
                                        Bank</span>
                                </span>
                                <span class="text-xs font-semibold text-slate-600 dark:text-slate-300">NGN</span>
                            </button>

                            <button type="button" class="pm-item flex w-full items-center justify-between gap-3 px-3 py-3 text-left hover:bg-slate-50
                                           dark:hover:bg-slate-900/60" data-label="Tether (USDT TRC20)" data-sub=""
                                data-currency="USDT" data-logo="/assets/payments/usdt-trc20.png"
                                data-terms-time="10-30 min" data-fee="0%">
                                <span class="flex items-center gap-3">
                                    <span
                                        class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-white ring-1 ring-slate-200 dark:bg-black dark:ring-slate-800">
                                        <img src="/assets/payments/usdt-trc20.png" alt="USDT"
                                            class="h-6 w-6 object-contain" />
                                    </span>
                                    <span class="text-sm font-medium text-slate-900 dark:text-slate-50">Tether (USDT
                                        TRC20)</span>
                                </span>
                                <span class="text-xs font-semibold text-slate-600 dark:text-slate-300">USDT</span>
                            </button>

                            <button type="button" class="pm-item flex w-full items-center justify-between gap-3 px-3 py-3 text-left hover:bg-slate-50
                                           dark:hover:bg-slate-900/60" data-label="Bitcoin (BTC)" data-sub=""
                                data-currency="BTC" data-logo="/assets/payments/btc.png" data-terms-time="30-60 min"
                                data-fee="0%">
                                <span class="flex items-center gap-3">
                                    <span
                                        class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-white ring-1 ring-slate-200 dark:bg-black dark:ring-slate-800">
                                        <img src="/assets/payments/btc.png" alt="BTC" class="h-6 w-6 object-contain" />
                                    </span>
                                    <span class="text-sm font-medium text-slate-900 dark:text-slate-50">Bitcoin
                                        (BTC)</span>
                                </span>
                                <span class="text-xs font-semibold text-slate-600 dark:text-slate-300">BTC</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Currency (disabled like Exness) -->
                <div class="md:col-span-4">
                    <label class="mb-2 block text-sm font-medium text-slate-400 dark:text-slate-500">
                        Currency
                    </label>
                    <div class="relative">
                        <select id="currencySelect" disabled class="h-12 w-full appearance-none rounded-md border border-slate-200 bg-slate-50 px-3 pr-10
                                       text-sm font-medium text-slate-400 cursor-not-allowed
                                       dark:border-slate-800 dark:bg-slate-900/40 dark:text-slate-500">
                            <option>NGN</option>
                        </select>
                        <span
                            class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 dark:text-slate-600">
                            <svg viewBox="0 0 20 20" class="h-5 w-5" fill="none" stroke="currentColor"
                                stroke-width="1.8" stroke-linecap="round">
                                <path d="M6 8l4 4 4-4" />
                            </svg>
                        </span>
                    </div>
                </div>

                <!-- From account -->
                <div class="md:col-span-12">
                    <label class="mb-2 block text-sm font-medium text-slate-700 dark:text-slate-200">
                        From account
                    </label>

                    <div class="relative">
                        <button type="button"
                            class="flex h-12 w-full items-center justify-between rounded-md border border-slate-200 bg-white px-3
                                       hover:border-slate-300 dark:border-slate-800 dark:bg-slate-950 dark:hover:border-slate-700 transition-colors">
                            <span class="flex items-center gap-3">
                                <span class="inline-flex items-center justify-center rounded bg-slate-100 px-2 py-1 text-xs font-semibold text-slate-700
                                             dark:bg-slate-800 dark:text-slate-200">MT5</span>
                                <span class="text-sm font-medium text-slate-900 dark:text-slate-50">222217462</span>
                            </span>

                            <span class="flex items-center gap-2">
                                <span class="text-sm font-semibold text-slate-900 dark:text-slate-50"
                                    id="balanceText">65,529 NGN</span>
                                <svg viewBox="0 0 20 20" class="h-5 w-5 text-slate-400 dark:text-slate-500" fill="none"
                                    stroke="currentColor" stroke-width="1.8" stroke-linecap="round">
                                    <path d="M6 8l4 4 4-4" />
                                </svg>
                            </span>
                        </button>
                    </div>
                </div>

                <!-- Amount -->
                <div class="md:col-span-12">
                    <label class="mb-2 block text-sm font-medium text-slate-700 dark:text-slate-200">
                        Amount
                    </label>

                    <div class="relative">
                        <input id="amountInput" inputmode="decimal" placeholder="0"
                            class="h-12 w-full rounded-md border border-slate-200 bg-white px-3 pr-16
                                      text-lg font-semibold text-slate-900 placeholder:text-slate-300
                                      focus:border-slate-400 focus:outline-none
                                      dark:border-slate-800 dark:bg-slate-950 dark:text-slate-50 dark:placeholder:text-slate-600" />

                        <span
                            class="absolute right-3 top-1/2 -translate-y-1/2 text-sm font-medium text-slate-700 dark:text-slate-200"
                            id="amountCurrency">
                            NGN
                        </span>
                    </div>

                    <div class="mt-2">
                        <a href="#"
                            class="text-sm text-slate-500 hover:text-blue-600 dark:text-slate-400 dark:hover:text-blue-400"
                            id="rangeText">
                            4,399 - 65,529 NGN
                        </a>
                    </div>
                </div>

                <!-- Summary box -->
                <div class="md:col-span-12">
                    <div
                        class="mt-8 flex items-center justify-between rounded-md bg-slate-50 px-6 py-6 dark:bg-slate-900/40">
                        <span class="text-sm text-slate-700 dark:text-slate-200">To be withdrawn</span>
                        <span class="text-3xl font-semibold text-slate-900 dark:text-white" id="toBeWithdrawn">
                            0 NGN
                        </span>
                    </div>

                    <div class="mt-6">
                        <button id="continueBtn" disabled class="h-12 rounded-md border border-slate-300 bg-white px-8 text-sm font-semibold text-slate-400
                                       cursor-not-allowed dark:border-slate-700 dark:bg-black dark:text-slate-600">
                            Continue
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT: Terms + FAQ -->
        <aside class="lg:col-span-4">
            <div class="hidden lg:block">
                <div class="border-l border-slate-200 pl-8 dark:border-slate-800">
                    <h3 class="text-xl font-semibold text-slate-900 dark:text-white">Terms</h3>

                    <div class="mt-4 space-y-2 text-sm text-slate-600 dark:text-slate-300">
                        <div class="flex items-center justify-between gap-4">
                            <span class="text-slate-500 dark:text-slate-400">Average payment time</span>
                            <span class="font-medium text-slate-900 dark:text-slate-50" id="termsTime">1 hour</span>
                        </div>
                        <div class="flex items-center justify-between gap-4">
                            <span class="text-slate-500 dark:text-slate-400">Fee</span>
                            <span class="font-medium text-slate-900 dark:text-slate-50" id="termsFee">0%</span>
                        </div>
                    </div>

                    <h3 class="mt-10 text-xl font-semibold text-slate-900 dark:text-white">FAQ</h3>
                    <div class="mt-4 space-y-2 text-sm text-slate-600 dark:text-slate-300">
                        <a href="#" class="block hover:text-slate-900 dark:hover:text-white">How do I verify my
                            account?</a>
                        <a href="#" class="block hover:text-slate-900 dark:hover:text-white">How do I verify my online
                            banking account?</a>
                        <a href="#" class="block hover:text-slate-900 dark:hover:text-white">How do I withdraw with
                            online bank?</a>
                    </div>
                </div>
            </div>

            <!-- Mobile: Terms collapsed style (optional but clean) -->
            <div class="lg:hidden">
                <div
                    class="mt-6 rounded-xl border border-slate-200 bg-white p-4 dark:border-slate-800 dark:bg-slate-950">
                    <div class="flex items-center justify-between">
                        <h3 class="text-sm font-semibold text-slate-900 dark:text-slate-50">Terms</h3>
                        <div class="text-xs text-slate-500 dark:text-slate-400">
                            Fee <span class="font-semibold text-slate-900 dark:text-slate-50"
                                id="termsFeeMobile">0%</span>
                        </div>
                    </div>
                    <div class="mt-3 flex items-center justify-between text-sm text-slate-600 dark:text-slate-300">
                        <span class="text-slate-500 dark:text-slate-400">Average payment time</span>
                        <span class="font-medium text-slate-900 dark:text-slate-50" id="termsTimeMobile">1 hour</span>
                    </div>
                </div>
            </div>
        </aside>
    </div>
</div>

<script>
    // ===================== Payment Method Dropdown =====================
    (function () {
        const root = document.getElementById("pmRoot");
        if (!root) return;

        const btn = document.getElementById("pmBtn");
        const panel = document.getElementById("pmPanel");
        const caret = document.getElementById("pmCaret");

        const pmLogo = document.getElementById("pmLogo");
        const pmLabel = document.getElementById("pmLabel");

        const currencySelect = document.getElementById("currencySelect");
        const amountCurrency = document.getElementById("amountCurrency");
        const rangeText = document.getElementById("rangeText");

        const termsTime = document.getElementById("termsTime");
        const termsFee = document.getElementById("termsFee");
        const termsTimeMobile = document.getElementById("termsTimeMobile");
        const termsFeeMobile = document.getElementById("termsFeeMobile");

        const amountInput = document.getElementById("amountInput");
        const toBeWithdrawn = document.getElementById("toBeWithdrawn");
        const continueBtn = document.getElementById("continueBtn");

        // Limits (mock like screenshot)
        const limits = {
            NGN: { min: 4399, max: 65529, symbol: "NGN" },
            USDT: { min: 10, max: 5000, symbol: "USDT" },
            BTC: { min: 0.0001, max: 1, symbol: "BTC" }
        };

        function fmtNumber(n) {
            // Keep simple & consistent with your UI
            try {
                return new Intl.NumberFormat(undefined, { maximumFractionDigits: 8 }).format(n);
            } catch {
                return String(n);
            }
        }

        function open() {
            panel.classList.remove("hidden");
            btn.setAttribute("aria-expanded", "true");
            caret.classList.add("rotate-180");
        }

        function close() {
            panel.classList.add("hidden");
            btn.setAttribute("aria-expanded", "false");
            caret.classList.remove("rotate-180");
        }

        function toggle() {
            panel.classList.contains("hidden") ? open() : close();
        }

        btn?.addEventListener("click", (e) => {
            e.stopPropagation();
            toggle();
        });

        document.addEventListener("click", (e) => {
            if (!root.contains(e.target)) close();
        });

        function setMethod({ label, currency, logo, termsTimeVal, feeVal }) {
            // Header
            pmLabel.textContent = label;
            if (pmLogo && logo) pmLogo.src = logo;

            // Currency display (disabled select — just update option text)
            if (currencySelect) currencySelect.innerHTML = `<option>${currency}</option>`;
            if (amountCurrency) amountCurrency.textContent = currency;

            // Terms
            if (termsTime) termsTime.textContent = termsTimeVal || "1 hour";
            if (termsFee) termsFee.textContent = feeVal || "0%";
            if (termsTimeMobile) termsTimeMobile.textContent = termsTimeVal || "1 hour";
            if (termsFeeMobile) termsFeeMobile.textContent = feeVal || "0%";

            // Limits line
            const lim = limits[currency] || limits.NGN;
            rangeText.textContent = `${fmtNumber(lim.min)} - ${fmtNumber(lim.max)} ${currency}`;

            // Reset amount
            amountInput.value = "";
            toBeWithdrawn.textContent = `0 ${currency}`;
            disableContinue();
        }

        function disableContinue() {
            continueBtn.disabled = true;
            continueBtn.className =
                "h-12 rounded-md border border-slate-300 bg-white px-8 text-sm font-semibold text-slate-400 cursor-not-allowed " +
                "dark:border-slate-700 dark:bg-black dark:text-slate-600";
        }

        function enableContinue() {
            continueBtn.disabled = false;
            continueBtn.className =
                "h-12 rounded-md bg-[#F9D900] px-8 text-sm font-semibold text-black hover:bg-yellow-300 transition";
        }

        // Click items
        document.querySelectorAll(".pm-item").forEach((item) => {
            item.addEventListener("click", () => {
                const label = item.getAttribute("data-label") || "Online Bank";
                const currency = item.getAttribute("data-currency") || "NGN";
                const logo = item.getAttribute("data-logo") || "/assets/payments/online-bank.png";
                const t = item.getAttribute("data-terms-time") || "1 hour";
                const fee = item.getAttribute("data-fee") || "0%";

                setMethod({ label, currency, logo, termsTimeVal: t, feeVal: fee });
                close();
            });
        });

        // Amount logic
        function parseAmount(raw) {
            const cleaned = (raw || "").replace(/[,\s]/g, "");
            const num = Number(cleaned);
            return Number.isFinite(num) ? num : 0;
        }

        function validateAmount() {
            const currency = amountCurrency.textContent.trim() || "NGN";
            const lim = limits[currency] || limits.NGN;
            const val = parseAmount(amountInput.value);

            // Update summary
            toBeWithdrawn.textContent = `${val ? fmtNumber(val) : 0} ${currency}`;

            // Validate: min/max, >0
            const ok = val >= lim.min && val <= lim.max;
            ok ? enableContinue() : disableContinue();
        }

        amountInput?.addEventListener("input", validateAmount);

        // Continue action (demo)
        continueBtn?.addEventListener("click", () => {
            if (continueBtn.disabled) return;
            // Hook this to your MVC POST / confirm flow
            alert("Continue → proceed to confirmation screen (wire to your MVC action).");
        });

        // Init default method (matches screenshot)
        setMethod({
            label: "Online Bank",
            currency: "NGN",
            logo: "/assets/payments/online-bank.png",
            termsTimeVal: "1 hour",
            feeVal: "0%"
        });
    })();
</script>