@{
    ViewData["Title"] = "FAQ";
    Layout = "~/Views/Shared/_Account.cshtml";
}

<section class="mx-auto w-full max-w-6xl">
    <!-- Header -->
    <div class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
        <div>
            <h1 class="text-[44px] font-semibold leading-tight tracking-[-0.02em] text-slate-950 dark:text-white">
                FAQ
            </h1>
            <p class="mt-1 text-slate-700 dark:text-slate-200">
                Quick answers about deposits, withdrawals, verification, and security.
            </p>
        </div>

        <!-- Search -->
        <div class="w-full sm:w-[420px]">
            <div class="relative">
                <span
                    class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 dark:text-slate-300">
                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="7"></circle>
                        <path d="M21 21l-4.3-4.3"></path>
                    </svg>
                </span>

                <input id="faqSearch" type="text" placeholder="Search questions..." class="h-11 w-full rounded-lg border border-slate-900/15 bg-white pl-10 pr-3 text-sm text-slate-950 placeholder:text-slate-500
                              focus:outline-none focus:ring-4 focus:ring-slate-900/10 focus:border-slate-900/30
                              dark:border-white/15 dark:bg-black dark:text-white dark:placeholder:text-slate-400
                              dark:focus:ring-white/10 dark:focus:border-white/25" />
            </div>
        </div>
    </div>

    <!-- Layout -->
    <div class="mt-8 grid grid-cols-1 gap-6 lg:grid-cols-12">
        <!-- Left: Categories -->
        <aside class="lg:col-span-4">
            <div class="rounded-xl border border-slate-900/15 bg-white p-4 dark:border-white/15 dark:bg-black">
                <p class="px-2 pb-2 text-xs font-semibold uppercase tracking-wide text-slate-600 dark:text-slate-300">
                    Categories
                </p>

                <div class="space-y-1">
                    <button type="button" data-faq-filter="all" class="faqFilterBtn flex w-full items-center justify-between rounded-lg border border-transparent px-3 py-2 text-sm font-semibold
                                   bg-slate-950 text-white
                                   hover:bg-slate-900
                                   dark:bg-white dark:text-black dark:hover:bg-slate-100">
                        <span class="flex items-center gap-2">
                            <span class="grid h-8 w-8 place-items-center rounded-md border border-white/20 bg-black/20 text-white
                                         dark:border-black/20 dark:bg-white/20 dark:text-black">
                                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 6h16M4 12h16M4 18h16"></path>
                                </svg>
                            </span>
                            All topics
                        </span>
                        <span class="text-xs opacity-80" id="countAll">—</span>
                    </button>

                    <button type="button" data-faq-filter="payments" class="faqFilterBtn flex w-full items-center justify-between rounded-lg border border-transparent px-3 py-2 text-sm font-semibold
                                   text-slate-900 hover:bg-slate-100
                                   dark:text-white dark:hover:bg-white/10">
                        <span class="flex items-center gap-2">
                            <span class="grid h-8 w-8 place-items-center rounded-md border border-slate-900/15 bg-white text-slate-900
                                         dark:border-white/15 dark:bg-black dark:text-white">
                                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="6" width="18" height="12" rx="2"></rect>
                                    <path d="M16 12h3"></path>
                                </svg>
                            </span>
                            Payments & wallet
                        </span>
                        <span class="text-xs text-slate-600 dark:text-slate-300" id="countPayments">—</span>
                    </button>

                    <button type="button" data-faq-filter="verification" class="faqFilterBtn flex w-full items-center justify-between rounded-lg border border-transparent px-3 py-2 text-sm font-semibold
                                   text-slate-900 hover:bg-slate-100
                                   dark:text-white dark:hover:bg-white/10">
                        <span class="flex items-center gap-2">
                            <span class="grid h-8 w-8 place-items-center rounded-md border border-slate-900/15 bg-white text-slate-900
                                         dark:border-white/15 dark:bg-black dark:text-white">
                                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 22s8-4 8-10V6l-8-4-8 4v6c0 6 8 10 8 10z"></path>
                                    <path d="M9 12l2 2 4-4"></path>
                                </svg>
                            </span>
                            Verification
                        </span>
                        <span class="text-xs text-slate-600 dark:text-slate-300" id="countVerification">—</span>
                    </button>

                    <button type="button" data-faq-filter="security" class="faqFilterBtn flex w-full items-center justify-between rounded-lg border border-transparent px-3 py-2 text-sm font-semibold
                                   text-slate-900 hover:bg-slate-100
                                   dark:text-white dark:hover:bg-white/10">
                        <span class="flex items-center gap-2">
                            <span class="grid h-8 w-8 place-items-center rounded-md border border-slate-900/15 bg-white text-slate-900
                                         dark:border-white/15 dark:bg-black dark:text-white">
                                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="5" y="11" width="14" height="10" rx="2"></rect>
                                    <path d="M7 11V8a5 5 0 0 1 10 0v3"></path>
                                </svg>
                            </span>
                            Security
                        </span>
                        <span class="text-xs text-slate-600 dark:text-slate-300" id="countSecurity">—</span>
                    </button>

                    <button type="button" data-faq-filter="trading" class="faqFilterBtn flex w-full items-center justify-between rounded-lg border border-transparent px-3 py-2 text-sm font-semibold
                                   text-slate-900 hover:bg-slate-100
                                   dark:text-white dark:hover:bg-white/10">
                        <span class="flex items-center gap-2">
                            <span class="grid h-8 w-8 place-items-center rounded-md border border-slate-900/15 bg-white text-slate-900
                                         dark:border-white/15 dark:bg-black dark:text-white">
                                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M6 4v16"></path>
                                    <path d="M6 8h4v8H6z"></path>
                                    <path d="M18 4v16"></path>
                                    <path d="M14 10h4v4h-4z"></path>
                                </svg>
                            </span>
                            Trading
                        </span>
                        <span class="text-xs text-slate-600 dark:text-slate-300" id="countTrading">—</span>
                    </button>
                </div>

                <div class="mt-4 rounded-lg border border-slate-900/15 bg-white p-4 dark:border-white/15 dark:bg-black">
                    <p class="text-sm font-semibold text-slate-950 dark:text-white">Still need help?</p>
                    <p class="mt-1 text-sm text-slate-700 dark:text-slate-200">
                        Open a ticket or chat with support.
                    </p>

                    <div class="mt-3 flex gap-2">
                        <a href="/SupportHub"
                            class="inline-flex flex-1 items-center justify-center rounded-lg bg-brandYellow px-4 py-2 text-sm font-semibold text-black
                                  hover:brightness-95 active:brightness-90 focus:outline-none focus:ring-4 focus:ring-yellow-400/30">
                            Support hub
                        </a>
                        <button type="button"
                            class="inline-flex flex-1 items-center justify-center rounded-lg border border-slate-900/15 bg-white px-4 py-2 text-sm font-semibold text-slate-950
                                       hover:bg-slate-100 active:bg-slate-200
                                       dark:border-white/15 dark:bg-black dark:text-white dark:hover:bg-white/10 dark:active:bg-white/15">
                            Start chat
                        </button>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Right: FAQ list -->
        <div class="lg:col-span-8">
            <div class="rounded-xl border border-slate-900/15 bg-white dark:border-white/15 dark:bg-black">
                <div class="border-b border-slate-900/10 px-5 py-4 dark:border-white/10">
                    <p class="text-sm font-semibold text-slate-950 dark:text-white">Questions</p>
                    <p class="mt-1 text-sm text-slate-700 dark:text-slate-200" id="resultsMeta">
                        Showing all questions
                    </p>
                </div>

                <div id="faqList" class="divide-y divide-slate-900/10 dark:divide-white/10">
                    <!-- Payments -->
                    <div class="faqItem" data-category="payments"
                        data-search="how do i deposit funds deposit payment methods bank transfer crypto wallet">
                        <button type="button" class="faqQ w-full px-5 py-4 text-left" aria-expanded="false">
                            <div class="flex items-start justify-between gap-4">
                                <div class="min-w-0">
                                    <p class="text-[16px] font-semibold text-slate-950 dark:text-white">
                                        How do I deposit funds?
                                    </p>
                                    <p class="mt-1 text-sm text-slate-700 dark:text-slate-200">
                                        Available methods and expected processing times.
                                    </p>
                                </div>
                                <span class="mt-1 grid h-9 w-9 place-items-center rounded-full border border-slate-900/15 bg-white text-slate-900
                                             dark:border-white/15 dark:bg-black dark:text-white">
                                    <svg class="faqCaret h-4 w-4 transition-transform" viewBox="0 0 20 20" fill="none"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round">
                                        <path d="M6 8l4 4 4-4" />
                                    </svg>
                                </span>
                            </div>
                        </button>
                        <div class="faqA hidden px-5 pb-5">
                            <div class="rounded-lg border border-slate-900/15 bg-white p-4 text-sm text-slate-800
                                        dark:border-white/15 dark:bg-black dark:text-slate-100">
                                Go to <span class="font-semibold">Payments & wallet → Deposit</span>, choose a payment
                                method,
                                follow the on-screen instructions, and confirm. Once the provider accepts the request,
                                you can track it in <span class="font-semibold">Transaction history</span>.
                            </div>
                        </div>
                    </div>

                    <div class="faqItem" data-category="payments"
                        data-search="why is my withdrawal pending withdrawal status processing provider">
                        <button type="button" class="faqQ w-full px-5 py-4 text-left" aria-expanded="false">
                            <div class="flex items-start justify-between gap-4">
                                <div class="min-w-0">
                                    <p class="text-[16px] font-semibold text-slate-950 dark:text-white">
                                        Why is my withdrawal pending?
                                    </p>
                                    <p class="mt-1 text-sm text-slate-700 dark:text-slate-200">
                                        Common reasons for delays and what to check.
                                    </p>
                                </div>
                                <span class="mt-1 grid h-9 w-9 place-items-center rounded-full border border-slate-900/15 bg-white text-slate-900
                                             dark:border-white/15 dark:bg-black dark:text-white">
                                    <svg class="faqCaret h-4 w-4 transition-transform" viewBox="0 0 20 20" fill="none"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round">
                                        <path d="M6 8l4 4 4-4" />
                                    </svg>
                                </span>
                            </div>
                        </button>
                        <div class="faqA hidden px-5 pb-5">
                            <div class="rounded-lg border border-slate-900/15 bg-white p-4 text-sm text-slate-800
                                        dark:border-white/15 dark:bg-black dark:text-slate-100">
                                Pending withdrawals usually mean the provider is still processing the request.
                                Check <span class="font-semibold">Transaction history</span> for status updates.
                                If it stays pending longer than the stated average time, open a ticket in <span
                                    class="font-semibold">Support hub</span>.
                            </div>
                        </div>
                    </div>

                    <!-- Verification -->
                    <div class="faqItem" data-category="verification"
                        data-search="how do i verify my account kyc documents identity proof address">
                        <button type="button" class="faqQ w-full px-5 py-4 text-left" aria-expanded="false">
                            <div class="flex items-start justify-between gap-4">
                                <div class="min-w-0">
                                    <p class="text-[16px] font-semibold text-slate-950 dark:text-white">
                                        How do I verify my account?
                                    </p>
                                    <p class="mt-1 text-sm text-slate-700 dark:text-slate-200">
                                        Steps for identity and address verification.
                                    </p>
                                </div>
                                <span class="mt-1 grid h-9 w-9 place-items-center rounded-full border border-slate-900/15 bg-white text-slate-900
                                             dark:border-white/15 dark:bg-black dark:text-white">
                                    <svg class="faqCaret h-4 w-4 transition-transform" viewBox="0 0 20 20" fill="none"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round">
                                        <path d="M6 8l4 4 4-4" />
                                    </svg>
                                </span>
                            </div>
                        </button>
                        <div class="faqA hidden px-5 pb-5">
                            <div class="rounded-lg border border-slate-900/15 bg-white p-4 text-sm text-slate-800
                                        dark:border-white/15 dark:bg-black dark:text-slate-100">
                                Open <span class="font-semibold">Settings → Profile</span> and complete the verification
                                flow.
                                Upload valid identity documents and a proof of address where required. You’ll see the
                                verification status on the same page.
                            </div>
                        </div>
                    </div>

                    <!-- Security -->
                    <div class="faqItem" data-category="security"
                        data-search="enable 2fa two factor authentication security login otp">
                        <button type="button" class="faqQ w-full px-5 py-4 text-left" aria-expanded="false">
                            <div class="flex items-start justify-between gap-4">
                                <div class="min-w-0">
                                    <p class="text-[16px] font-semibold text-slate-950 dark:text-white">
                                        How do I enable 2FA?
                                    </p>
                                    <p class="mt-1 text-sm text-slate-700 dark:text-slate-200">
                                        Protect your account with an extra login step.
                                    </p>
                                </div>
                                <span class="mt-1 grid h-9 w-9 place-items-center rounded-full border border-slate-900/15 bg-white text-slate-900
                                             dark:border-white/15 dark:bg-black dark:text-white">
                                    <svg class="faqCaret h-4 w-4 transition-transform" viewBox="0 0 20 20" fill="none"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round">
                                        <path d="M6 8l4 4 4-4" />
                                    </svg>
                                </span>
                            </div>
                        </button>
                        <div class="faqA hidden px-5 pb-5">
                            <div class="rounded-lg border border-slate-900/15 bg-white p-4 text-sm text-slate-800
                                        dark:border-white/15 dark:bg-black dark:text-slate-100">
                                Go to <span class="font-semibold">Settings → Security</span> and turn on Two-Factor
                                Authentication.
                                Choose your preferred method (authenticator app, email, etc.), then follow the prompts
                                to complete setup.
                            </div>
                        </div>
                    </div>

                    <!-- Trading -->
                    <div class="faqItem" data-category="trading"
                        data-search="what is margin free margin equity leverage stop out margin call">
                        <button type="button" class="faqQ w-full px-5 py-4 text-left" aria-expanded="false">
                            <div class="flex items-start justify-between gap-4">
                                <div class="min-w-0">
                                    <p class="text-[16px] font-semibold text-slate-950 dark:text-white">
                                        What is margin and free margin?
                                    </p>
                                    <p class="mt-1 text-sm text-slate-700 dark:text-slate-200">
                                        A simple explanation for trading accounts.
                                    </p>
                                </div>
                                <span class="mt-1 grid h-9 w-9 place-items-center rounded-full border border-slate-900/15 bg-white text-slate-900
                                             dark:border-white/15 dark:bg-black dark:text-white">
                                    <svg class="faqCaret h-4 w-4 transition-transform" viewBox="0 0 20 20" fill="none"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round">
                                        <path d="M6 8l4 4 4-4" />
                                    </svg>
                                </span>
                            </div>
                        </button>
                        <div class="faqA hidden px-5 pb-5">
                            <div class="rounded-lg border border-slate-900/15 bg-white p-4 text-sm text-slate-800
                                        dark:border-white/15 dark:bg-black dark:text-slate-100">
                                <span class="font-semibold">Margin</span> is the portion of your balance locked to keep
                                positions open.
                                <span class="font-semibold">Free margin</span> is what remains available to open new
                                positions or absorb losses.
                                If free margin drops too low, you may receive a margin call or stop-out depending on
                                risk rules.
                            </div>
                        </div>
                    </div>

                    <!-- Empty state -->
                    <div id="faqEmpty" class="hidden px-5 py-10 text-center">
                        <div class="mx-auto grid h-12 w-12 place-items-center rounded-lg border border-slate-900/15 bg-white text-slate-700
                                    dark:border-white/15 dark:bg-black dark:text-slate-200">
                            <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 21l-4.3-4.3"></path>
                                <circle cx="11" cy="11" r="7"></circle>
                            </svg>
                        </div>
                        <p class="mt-3 text-sm font-semibold text-slate-950 dark:text-white">No results found</p>
                        <p class="mt-1 text-sm text-slate-700 dark:text-slate-200">
                            Try a different search term or change the category.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="mt-6 flex flex-col gap-3 rounded-xl border border-slate-900/15 bg-white p-5
                        dark:border-white/15 dark:bg-black sm:flex-row sm:items-center sm:justify-between">
                <div>
                    <p class="text-sm font-semibold text-slate-950 dark:text-white">Can’t find what you need?</p>
                    <p class="mt-1 text-sm text-slate-700 dark:text-slate-200">
                        Open Support hub or start a chat.
                    </p>
                </div>

                <div class="flex gap-2">
                    <a href="/SupportHub"
                        class="inline-flex items-center justify-center rounded-lg bg-brandYellow px-5 py-2.5 text-sm font-semibold text-black
                              hover:brightness-95 active:brightness-90 focus:outline-none focus:ring-4 focus:ring-yellow-400/30">
                        Open Support hub
                    </a>
                    <button type="button"
                        class="inline-flex items-center justify-center rounded-lg border border-slate-900/15 bg-white px-5 py-2.5 text-sm font-semibold text-slate-950
                                   hover:bg-slate-100 active:bg-slate-200
                                   dark:border-white/15 dark:bg-black dark:text-white dark:hover:bg-white/10 dark:active:bg-white/15">
                        Start chat
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        // ====== FAQ page: search + filter + accordion ======
        const faqSearch = document.getElementById("faqSearch");
        const faqItems = Array.from(document.querySelectorAll(".faqItem"));
        const filterBtns = Array.from(document.querySelectorAll(".faqFilterBtn"));
        const faqEmpty = document.getElementById("faqEmpty");
        const resultsMeta = document.getElementById("resultsMeta");

        let activeCategory = "all";

        function counts() {
            const total = faqItems.length;
            const byCat = (cat) => faqItems.filter(x => x.dataset.category === cat).length;

            document.getElementById("countAll").textContent = total;
            document.getElementById("countPayments").textContent = byCat("payments");
            document.getElementById("countVerification").textContent = byCat("verification");
            document.getElementById("countSecurity").textContent = byCat("security");
            document.getElementById("countTrading").textContent = byCat("trading");
        }

        function closeAllAnswers() {
            faqItems.forEach(item => {
                item.querySelector(".faqA")?.classList.add("hidden");
                const q = item.querySelector(".faqQ");
                if (q) q.setAttribute("aria-expanded", "false");
                item.querySelector(".faqCaret")?.classList.remove("rotate-180");
            });
        }

        function setActiveFilterUI() {
            filterBtns.forEach(btn => {
                const key = btn.getAttribute("data-faq-filter");
                const isActive = key === activeCategory;

                // reset
                btn.classList.remove(
                    "bg-slate-950", "text-white", "hover:bg-slate-900",
                    "dark:bg-white", "dark:text-black", "dark:hover:bg-slate-100"
                );

                if (isActive) {
                    btn.classList.add("bg-slate-950", "text-white", "hover:bg-slate-900");
                    btn.classList.add("dark:bg-white", "dark:text-black", "dark:hover:bg-slate-100");
                }
            });
        }

        function applyFilterAndSearch() {
            const term = (faqSearch?.value || "").trim().toLowerCase();
            let visibleCount = 0;

            faqItems.forEach(item => {
                const cat = item.dataset.category || "";
                const searchText = (item.dataset.search || "").toLowerCase();

                const catOk = (activeCategory === "all") || (cat === activeCategory);
                const termOk = !term || searchText.includes(term);

                const show = catOk && termOk;
                item.classList.toggle("hidden", !show);
                if (show) visibleCount++;
            });

            faqEmpty.classList.toggle("hidden", visibleCount !== 0);

            const catLabel = activeCategory === "all" ? "all questions" : `${activeCategory} questions`;
            resultsMeta.textContent = term
                ? `Showing ${visibleCount} result(s) for “${term}” in ${catLabel}.`
                : `Showing ${visibleCount} ${catLabel}.`;

            closeAllAnswers();
        }

        // Accordion click
        document.querySelectorAll(".faqQ").forEach(btn => {
            btn.addEventListener("click", () => {
                const parent = btn.closest(".faqItem");
                if (!parent) return;

                const answer = parent.querySelector(".faqA");
                const caret = parent.querySelector(".faqCaret");
                const isOpen = btn.getAttribute("aria-expanded") === "true";

                closeAllAnswers();

                if (!isOpen) {
                    answer?.classList.remove("hidden");
                    btn.setAttribute("aria-expanded", "true");
                    caret?.classList.add("rotate-180");
                }
            });
        });

        // Filter click
        filterBtns.forEach(btn => {
            btn.addEventListener("click", () => {
                activeCategory = btn.getAttribute("data-faq-filter") || "all";
                setActiveFilterUI();
                applyFilterAndSearch();
            });
        });

        // Search input
        faqSearch?.addEventListener("input", applyFilterAndSearch);

        // init
        counts();
        setActiveFilterUI();
        applyFilterAndSearch();
    </script>
}